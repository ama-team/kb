---
title: Инициализация данных приложения
---

Зачастую при выкладке приложения его необходимо заполнить начальными 
данными - например, если конфигурация приложения частично или полностью
сохраняется в базе данных. В таких случаях требуется отличный от 
миграций механизм, который получил название Seed (и пока не получил
устоявшегося перевода на русский язык).

# Мотивация

Несмотря на существование похожего механизма [миграций](migrations),
этот механизм не подходит для инициализации данных в БД. Принципы
миграций не позволяют им менять поведение в зависимости от текущего 
окружения или текущего наполнения базы данных, миграции всегда 
должны быть детерминированы, и единственный фактор, который может 
влиять на разницу в их применении - это конечный движок БД, который 
может не поддерживать или выполнять конкретные изменения автоматически.
Кроме того, миграции не могут отличить модифицированные пользователем 
записи от исходных. Можно представить следующий пример:

- Миграция А добавляет конфигурационное значение Х = 30
- Совершается релиз приложения
- Создатели приложения собирают статистику и выясняют, что у 50% 
пользователей Х = 40, и решают, что это должно быть значением по 
умолчанию
- В этот момент можно было бы выпустить миграцию, которая изменит Х с 
30 на 40, однако оно неизбежно затронет тех пользователей, которых 
устраивает значение 30, и которые не хотели бы его менять.

Поэтому для инициализации данных в БД требуется другой механизм, 
который получил название *Seed*. Этот механизм инициализирует данные в 
БД, причем в отличие от миграций эта инициализация может отличаться в 
зависимости от окружения, текущих данных в БД и прочих внешних 
параметров. 
  
Подобная инициализация, как правило, имеет две основных цели:

- Заполнить приложения исходными данными, которые в последующих релизах
могут иметь другие значения или расшириться
- Заполнить приложение тестовыми данными, сгенерировав их на ходу

Механизм инициализации данных гораздо более гибок и было бы неправильно
говорить о его принципах в отрыве от конкретного случая. В большинстве
случаях инициализация или генерация данных должна быть также 
идемпотентной и должна игнорировать записи, которые были вставлены на
предыдущих запусках (даже если они были вспоследствии удалены).

## Декларативная / исполняемая

Как и миграции, инициализация данных может описываться декларативно или
в виде исполняемых файлов. В отличие от миграций, исполняемое описание
может оказаться полезней, так как дает больший простор для работы с 
данными и позволяет динамически задавать внешние ключи в тех случаях, 
когда использование натуральных ключей по тем или иным причинам 
невозможно.

# Популярные реализации

На данный момент идея инициализации данных приложения еще не получила 
такую же популярность, как идея миграций, поэтому количество 
свободно распространяемых инструментов пока что не такое большое.

## Инструменты заполнения БД

### PHP

1. [Phinx][phinx]
 
## Генерация случайных данных

### PHP

1. [Haigha][haigha]
2. [Faker][faker-php]

### Ruby

1. [Faker][faker-ruby]

### Java

1. [Faker #1][faker-java-1]
2. [Faker #2][faker-java-2]

  [phinx]: https://phinx.org/
  [haigha]: https://github.com/linkorb/haigha
  [faker-php]: https://github.com/fzaninotto/Faker
  [faker-ruby]: https://github.com/stympy/faker
  [faker-java-1]: https://github.com/blocoio/faker
  [faker-java-2]: https://github.com/DiUS/java-faker