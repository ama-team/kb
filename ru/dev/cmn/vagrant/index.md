---
title: Работа с Vagrant
---

## Что такое Vagrant?

Vagrant - это средство конфигурации окружений, позволяющее воссоздать 
одно и то же окружение на разных машинах.

При разработке проектов важно, чтобы окружение - все внешние факторы, 
влияющие на приложение, такие как конкретная база данных, ее версия, 
операционная система и специфичные настройки ядра (если требуются), 
интерпретатор языка и его версия - было максимально близко к тому, в 
котором существует проект в рабочем режиме, и чтобы это окружение было 
одинаковым у всех разработчиков. Достижение этого условия позволяет 
защитить проект от ошибок и трения из-за разницы в окружении - например, 
регистронезависимость Windows позволит обращаться к файлам по именам 
в произвольным регистром, и проект, работающий на Windows, может не 
запуститься на Linux, или какие-то Linux-специфичные расширения могут 
не иметь версии для Windows - подобные проблемы сами исчезают, если 
проект на машине разработчика работает в тех же условиях, что и в 
реальном боевом режиме.

Vagrant является утилитой, которая позволяет управлять окружением 
разработки. Он позволяет всем разработчикам проекта создавать и 
запускать идентичные окружения одной командой с помощью файла 
конфигурации, который можно хранить прямо в репозитории. 

Как правило, воспроизведение окружения достигается с помощью 
создания виртуальной машины через VirtualBox, конфигурирования
(*провизии* в терминологии chef) этой виртуальной машины и монтирования
директории проекта внутрь виртуальной машины. Необхождимо сказать, что 
Vagrant поддерживает и другие способы воссоздания окружения - в 
терминологии Vagrant это называется *провайдерами*.

## Что необходимо для того, чтобы начать им пользоваться?

Для того, чтобы пользоваться Vagrant, необходимо скачать сам Vagrant 
([официальная страница загрузок][vagrant/download]), и (в тех случаях,
когда предполагается использование VirtualBox в качестве провайдера)
VirtualBox ([официальная страница загрузок][virtualbox/download]).
Иногда может потребоваться [отключение Hyper-V][hyperv/disabling] для
запуска VirtualBox.

После установки Vagrant будет доступен из командной строки в виде
одноименного исполняемого файла. Для того, чтобы проинициализировать 
проект конфигурацией по умолчанию, достаточно использовать следующую
команду:

```bash
vagrant init
```

Это создаст Vagrantfile (конфигурационный файл Vagrant) в той 
директории, из которой была вызвана команда. Конфигурация в этом файле 
описывается с помощью DSL в виде вызовов методов на языке Ruby, что 
можно увидеть в созданном примере.

Для запуска примера достаточно поменять `config.vm.box` на реально 
существующий образ, например, `ubuntu/xenial64` (Ubuntu 16.04, 64 бит).
После этого можно запустить машину следующей командой

```bash
vagrant up
```

Можно указать конкретный провайдер для запуска, если он не был 
определен в самом Vagrantfile:
 
```bash
vagrant up --provider virtualbox
```

После этого Vagrant

- Скачает указанный образ, если его еще нет на локальной машине.
- Создаст виртуальную машину VirtualBox на основе образа
- Применит провизию (сконфигурирует машину), если провизия была 
определена в Vagrantfile
- Пробросит указанные в Vagrantfile порты хост-машины в гостевую 
(обычной в виртуальную)
- Смонтирует указанные в Vagrantfile директории хост-машины в гостевую

Таким образом, при корректном Vagrantfile конечному разработчику для 
поднятия окружения обычно достаточно установить сам Vagrant, 
установить VirtualBox и выполнить команду `vagrant up` в директории или
поддиректории проекта, после чего Vagrant возьмет на себя все остальные 
заботы и, после корректной инициализации сам создаст на хост-машине 
порты, по которым будет доступен проект. 

## Плагины Vagrant

В ряде случае Vagrant могут понадобиться дополнительный функционал, 
например:

- При провизии с помощью Chef зачастую необходимо установить 
дополнительные зависимости
- При тех или иных событиях жизненного цикла необходимо выполнять
дополнительные действия 

Для этого в Vagrant существует система плагинов. Для того, чтобы 
установить плагин, достаточно вызвать команду

```bash
vagrant plugin install %имя плагина%
```

  [vagrant/home]: https://vagrantup.com/
  [vagrant/download]: https://www.vagrantup.com/downloads.html
  [virtualbox/home]: https://www.virtualbox.org/
  [virtualbox/download]: https://www.virtualbox.org/wiki/Downloads
  [hyperv/disabling]: http://blog.hazaveh.net/2015/11/easily-disable-hyper-v-to-run-vmware-and-virtual-box/